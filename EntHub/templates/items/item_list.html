{% extends 'base/base.html' %}

{% block content %}

<div class="container">

	<h1>{{header}}</h1>
	<hr/>

	{% block tabs %}
	{% endblock %}

	<div class="row">

		<div class="col-md-3">
			
			<form method="post">
				{% csrf_token %}
				<div class="list-group">
					<button type="submit" class="list-group-item {% if not m %}active{% endif %}">
						Todo
					</button>
					{% for mark, count in marks.items %}
					<button type="submit" name="m" value="{{mark}}"
							class="list-group-item {% if m == mark %}active{% endif %}">
						<span class="badge">{{count}}</span>
						{% if mark == "pen" %}
							<i class="glyphicon glyphicon-time"></i>Pendiente
						{% elif mark == "ley" %}
							<i class="glyphicon glyphicon-play"></i>Leyendo
						{% elif mark == "pau" %}
							<i class="glyphicon glyphicon-pause"></i>Pausado
						{% elif mark == "lei" %}
							<i class="glyphicon glyphicon-ok"></i>Leído
						{% elif mark == "jug" %}
							<i class="glyphicon glyphicon-play"></i>Jugando
						{% elif mark == "ter" %}
							<i class="glyphicon glyphicon-ok"></i>Terminado
						{% elif mark == "com" %}
							<i class="glyphicon glyphicon-check"></i>Completado
						{% elif mark == "sig" %}
							<i class="glyphicon glyphicon-play"></i>Siguiendo
						{% elif mark == "fin" %}
							<i class="glyphicon glyphicon-ok"></i>Finalizado
						{% elif mark == "vis" %}
							<i class="glyphicon glyphicon-ok"></i>Visto
						{% endif %}
					</button>
					{% endfor %}
					<button type="submit" name="m" value="fav"
							class="list-group-item {% if m == 'fav' %}active{% endif %}">
						<span class="badge">{{fav}}</span>
						<i class="glyphicon glyphicon-heart"></i>Favorito
					</button>
				</div>
				{% if item_path == 'games' %}
				<div class="panel panel-default">
					<div class="panel-body">
						<div class="row col-md-4">
							<div class="toggle-switch">
								<input id="add-dlcs" type="checkbox" name="add-dlcs" 
									{% if add_dlcs %}checked{% endif %} />
								<label for="add-dlcs" class="label-primary"></label>
							</div>
						</div>
						<div class="col-md-8">
							<span>Incluir DLCs</span>
						</div>
					</div>
				</div>
				{% endif %}
			</form>

			{% if user.is_staff %}
			<a href="/items/{{item_path}}/new" class="btn btn-primary btn-block">Añadir nuevo</a>
			{% endif %}

		</div>

		<div class="col-md-9">
		
			{% if items %}

			<div class="row">
				{% for item in items %}
				<div class="col-md-3">
					{% include "items/item_preview.html" %}
				</div>
				{% endfor %}
			</div>

			<div class="row text-center">
				{% if items.paginator.num_pages > 1 %}
				<br>
				<div class="btn-group" role="group">
					{% if items.has_previous %}
					<span id="previous-page" hidden>{{items.previous_page_number}}</span>
					<button onclick="previousPage()" class="btn btn-primary">&laquo;</button>
					{% endif %}
					<span class="btn btn-primary">
						Página {{items.number}} de {{items.paginator.num_pages}}
					</span>
					{% if items.has_next %}
					<span id="next-page" hidden>{{items.next_page_number}}</span>
					<button onclick="nextPage()" class="btn btn-primary">&raquo;</button>
					{% endif %}
				</div>
				{% endif %}
			</div>

			{% else %}

			<div class="alert alert-warning">
				<span>No hay nada para mostrar</span>
			</div>

			{% endif %}

		</div>

	</div>

</div>

{% endblock %}

{% block scripts %}

<script type="text/javascript">
	$('#add-dlcs').on('change', function(event) {
		$('button.list-group-item.active').click();
	});
</script>

<script type="text/javascript">
	function navToPage(page) {
		var input = $("<input>")
			.attr("type", "hidden")
			.attr("name", "page")
			.val(page);
		$("form").append(input);
		$('button.list-group-item.active').click();
	}
	function previousPage() {
		let page = $("#previous-page").text();
		navToPage(page);
	}
	function nextPage() {
		let page = $("#next-page").text();
		navToPage(page);
	}
</script>

{% endblock scripts %}