{% extends 'items/item_detail.html' %}

{% block more_fields %}

<p>
	<b>Categoría:</b>
	<span class="label label-default">{{object.get_category_display}}</span>
</p>
<p>
	<b>Estado:</b>
	<span class="label {{label}}">{{object.get_status_display}}</span>
</p>

{% endblock %}

{% block subitems_tab %}
<li role="presentation">
	<a href="#subitems" data-toggle="tab">Capítulos</a>
</li>
{% endblock %}

{% block subitems %}

{% if chapters %}

<div class="text-center">
	<span id="progress-value">{{tic_chapters}}</span>
	<span> / {{all_chapters}} capítulos vistos</span>
</div>
<div class="progress">
	<div class="progress-bar" role="progressbar" style="{{progress}}" aria-valuenow="{{tic_chapters}}" aria-valuemin="0" aria-valuemax="{{all_chapters}}"></div>
</div>

<!-- <ul class="nav nav-tabs seasons">
	{% for season in seasons %}
	<li class="{% if season == 1 %}active{% endif %}">
		<a href="#{{season}}" data-toggle="tab">
			{% if season == 0 %}Extras{% else %}T{{season}}{% endif %}
		</a>
	</li>
	{% endfor %}
</ul> -->

<div class="row">
	<div class="col-md-6">
		<div class="form-group">
			<select name="seasons" class="form-control">
				{% for season in seasons %}
				<option value="{{season}}" {% if season == 1 %}selected{% endif %}>
					{% if season == 0 %}Extras{% else %}Temporada {{season}}{% endif %}
				</option>
				{% endfor %}
			</select>
		</div>
	</div>
	<div class="col-md-6 text-right">
		<button onclick="ticAll($(this),'chapter');return false;" class="btn btn-tic-all" data-toggle="tooltip" data-placement="left" title="Marcar todo">
			<i class="glyphicon glyphicon-eye-open"></i>
		</button>
	</div>
</div>

<div class="tab-content">
	{% for season, season_chapters in chapters.items %}
	<div id="season-{{season}}" class="tab-pane fade {% if season == 1 %}in active{% endif %}">
		<table class="table table-striped table-hover">
			<tbody>
				{% for c in season_chapters|dictsort:"number" %}
				<tr>
					<td class="align-middle">{{c.number}}</td>
					<td>{{c.name}}</td>
					<td class="text-right">
						{% if user in c.tics.all %}
						<button name="{{c.id}}" value="untic" onclick="tic($(this),'chapter');return false;" class="btn" data-toggle="tooltip" title="Quitar visto">
							<i class="glyphicon glyphicon-eye-close"></i>
						</button>
						{% else %}
						<button name="{{c.id}}" value="tic" onclick="tic($(this),'chapter');return false;" class="btn" data-toggle="tooltip" title="Marcar visto">
							<i class="glyphicon glyphicon-eye-open"></i>
						</button>
						{% endif %}
					</td>
				</tr>
				{% endfor %}
			</tbody>
		</table>
    </div>
	{% endfor %}
</div>

{% else %}

<div class="alert alert-warning">
	<span>No hay ningún capítulo</span>
</div>

{% endif %}

{% if user.is_staff %}
<a href="{% url 'items:add_chapter' pk=object.id %}" class="btn btn-link">Añadir capítulo</a>
{% endif %}

{% endblock %}

{% block more_scripts %}

{# Season select #}
<script type="text/javascript">
	(function() {
		var prevSeasonId;
		var select = $('select[name=seasons]');
		select.on('focus', function () {
			prevSeasonId = "#season-" + this.value;
		}).change(function() {
			var newSeasonId = "#season-" + this.value;
			$(prevSeasonId).removeClass("in active");
			$(newSeasonId).addClass("in active");
			prevSeasonId = newSeasonId;
			select.blur();
		});
	})();
</script>

{% endblock %}