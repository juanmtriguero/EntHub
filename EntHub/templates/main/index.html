{% extends 'base/base.html' %}

{% block content %}

<div class="container">
	<div class="row">

		<div class="col-md-3">
			<div class="panel panel-primary activity">
				<div class="panel-heading">
					<h3 class="panel-title">Actividad reciente</h3>
				</div>
				<div class="panel-body">
					<table class="table table-striped table-hover">
						<tbody>
							{% if logs %}
								{% for log in logs %}
								<tr>
									<td>
										{% if log.follower %}
										<a href="/accounts/{{log.follower.id}}"><h6>{{log.follower}}</h6></a> ha empezado a seguir a <a href="/accounts/{{log.following.id}}"><h6>{{log.following}}</h6></a>
										{% else %}
										<a href="/accounts/{{log.user.account.id}}"><h6>{{log.user}}</h6></a> ha marcado
										{% if log.book %}el <span class="text-success">libro</span> <a href="/items/books/{{log.book.id}}"><h6>{{log.book}}</h6></a>
										{% elif log.movie %}{% if log.movie.category == 'pel' %}la{% else %}el{% endif %} <span class="text-primary">{{log.movie.get_category_display|lower}}</span> <a href="/items/movies/{{log.movie.id}}"><h6>{{log.movie}}</h6></a>
										{% elif log.series %}{% if log.series.category in 'ser min' %}la{% else %}el{% endif %} <span class="text-info">{{log.series.get_category_display|lower}}</span> <a href="/items/series/{{log.series.id}}"><h6>{{log.series}}</h6></a>
										{% elif log.comic %}el <span class="text-warning">cómic</span> <a href="/items/comics/{{log.comic.id}}"><h6>{{log.comic}}</h6></a>
										{% elif log.comicseries %}la <span class="text-warning">comicserie</span> <a href="/items/comicseries/{{log.comicseries.id}}"><h6>{{log.comicseries}}</h6></a>
										{% elif log.game %}el <span class="text-danger">videojuego</span> <a href="/items/games/{{log.game.id}}"><h6>{{log.game}}</h6></a>
										{% elif log.dlc %}el <span class="text-danger">DLC</span> <a href="/items/dlcs/{{log.dlc.id}}"><h6>{{log.dlc}}</h6></a>
										{% endif %} como <h6>{{log.get_option_display|lower}}</h6>
										{% endif %}
										<br/>
										<small class="text-muted">Hace {{log.date|timesince}}</small>
									</td>
								</tr>
								{% endfor %}
							{% else %}
							<tr>
								<td>No hay actividad reciente</td>
							</tr>
							{% endif %}
						</tbody>
					</table>
				</div>
			</div>
		</div>

		<div class="col-md-9">
			<form action="{% url 'main:index' %}" id="form" method="post">
				{% csrf_token %}
				<input type="hidden" name="option" value="{{option}}" />
				<div class="btn-group btn-group-justified tabs" id="option">
					<a href="#" data-option="rec" class="btn btn-{% if option == 'rec' %}primary{% else %}default{% endif %}">Recomendado para ti</a>
					<a href="#" data-option="nov" class="btn btn-{% if option == 'nov' %}primary{% else %}default{% endif %}">Novedades</a>
					<a href="#" data-option="val" class="btn btn-{% if option == 'val' %}primary{% else %}default{% endif %}">Mejor valorados</a>
				</div>
			</form>
			<h3>{{prefix}} en cine</h3>
			<hr/>
			<div class="row">
				{% for item, option in movies.items %}
				<div class="col-md-3">
					{% include "items/item_preview.html" with item_path="movies" %}
				</div>
				{% endfor %}
			</div>
			<h3>{{prefix}} en televisión</h3>
			<hr/>
			<div class="row">
				{% for item, option in series.items %}
				<div class="col-md-3">
					{% include "items/item_preview.html" with item_path="series" %}
				</div>
				{% endfor %}
			</div>
			<h3>{{prefix}} en libros</h3>
			<hr/>
			<div class="row">
				{% for item, option in books.items %}
				<div class="col-md-3">
					{% include "items/item_preview.html" with item_path="books" %}
				</div>
				{% endfor %}
			</div>
			<h3>{{prefix}} en videojuegos</h3>
			<hr/>
			<div class="row">
				{% for item, option in games.items %}
				<div class="col-md-3">
					{% include "items/item_preview.html" with item_path="games" %}
				</div>
				{% endfor %}
			</div>
			<h3>{{prefix}} en cómics</h3>
			<hr/>
			<div class="row">
				{% for item, option in comics.items %}
				<div class="col-md-3">
					{% include "items/item_preview.html" with item_path="comics" %}
				</div>
				{% endfor %}
				{% for item, option in comic_series.items %}
				<div class="col-md-3">
					{% include "items/item_preview.html" with item_path="comicseries" %}
				</div>
				{% endfor %}
			</div>
		</div>

	</div>
</div>

{% endblock %}

{% block scripts %}

<script type="text/javascript">
	$('#option a').on('click', function(event) {
		event.preventDefault();
		$('input[name="option"]').val($(this).data('option'));
		$('#form').submit();
	});
</script>

{% endblock scripts %}